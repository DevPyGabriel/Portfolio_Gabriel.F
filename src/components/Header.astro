---
import MenuBtn from "../icons/MenuBtn.astro";
import CloseBtn from "../icons/CloseBtn.astro";
import Logo from "../icons/Logo.astro";
---

<header id="menuContainer" class="flex justify-center items-center py-3 sm:py-4 w-full mx-auto fixed top-0 right-0 left-0 backdrop-blur-xl bg-slate-950/20 z-50">
        
	<nav id="menuDesktop" class="hidden sm:flex gap-x-4 sm:gap-x-8">
		<a class="opacity-60 hover:opacity-100 transition duration-200 ease-in-out" href="#top">Inicio</a>
		<a class="opacity-60 hover:opacity-100 transition duration-200 ease-in-out" href="#experiencia">Experiencia</a>
		<a class="opacity-60 hover:opacity-100 transition duration-200 ease-in-out" href="#proyectos">Proyectos</a>
		<a class="opacity-60 hover:opacity-100 transition duration-200 ease-in-out" href="#sobre-mi">Sobre mi</a>
		<a class="opacity-60 hover:opacity-100 transition duration-200 ease-in-out" href="#contacto">Contacto</a>	
	</nav>

	<div id="menuIcons" class="flex justify-between items-center px-8 sm:hidden w-full">
		<div class="flex items-center gap-x-1">
			<Logo id="logo" class="size-7 text-yellow-200" />
			<span class="text-lg font-bold">Dev</span>
		</div>
		<button id="menuToggle" aria-expanded="false">
			<MenuBtn id="MenuBtn" class="size-8" />
			<CloseBtn id="CloseBtn" class="size-8 hidden" />
		</button>
	</div>

</header>

	<nav 
	id="menuResponsive" 
	class="flex flex-col fixed top-0 right-0 left-0 mx-auto px-8 justify-end items-end mt-14 w-full max-w-[700px] sm:hidden backdrop-blur-xl z-50 bg-slate-950/30 -translate-y-2 opacity-0 transition duration-200 ease-out pointer-events-none" 
	aria-hidden="true"
	>

		<a class="py-2 border-b text-right border-gray-600 w-full opacity-60 hover:opacity-100 transition duration-200 ease-in-out" href="#top">Inicio</a>
		<a class="py-2 border-b text-right border-gray-600 w-full opacity-60 hover:opacity-100 transition duration-200 ease-in-out" href="#experiencia">Experiencia</a>
		<a class="py-2 border-b text-right border-gray-600 w-full opacity-60 hover:opacity-100 transition duration-200 ease-in-out" href="#proyectos">Proyectos</a>
		<a class="py-2 border-b text-right border-gray-600 w-full opacity-60 hover:opacity-100 transition duration-200 ease-in-out" href="#sobre-mi">Sobre mi</a>
		<a class="py-2 text-right border-gray-600 w-full opacity-60 hover:opacity-100 transition duration-200 ease-in-out" href="#contacto">Contacto</a>

	</nav>

<script type="module">
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.getElementById('menuToggle');
  const nav = document.getElementById('menuResponsive');
  const iconOpen = document.getElementById('iconOpen');
  const iconClose = document.getElementById('iconClose');

  if (!btn || !nav) return;

  function openMenu() {
    btn.setAttribute('aria-expanded', 'true');
    nav.classList.remove('opacity-0', '-translate-y-2', 'pointer-events-none');
    nav.classList.add('opacity-100', 'translate-y-0');
    nav.setAttribute('aria-hidden', 'false');
    if (iconOpen && iconClose) { iconOpen.classList.add('hidden'); iconClose.classList.remove('hidden'); }
  }

  function closeMenu() {
    btn.setAttribute('aria-expanded', 'false');
    nav.classList.add('opacity-0', '-translate-y-2', 'pointer-events-none');
    nav.classList.remove('opacity-100', 'translate-y-0');
    nav.setAttribute('aria-hidden', 'true');
    if (iconOpen && iconClose) { iconOpen.classList.remove('hidden'); iconClose.classList.add('hidden'); }
  }

  btn.addEventListener('click', (e) => {
    const expanded = btn.getAttribute('aria-expanded') === 'true';
    if (expanded) closeMenu(); else openMenu();
    e.stopPropagation();
  });

  // cerrar al clicar en un enlace
  nav.querySelectorAll('a[href^="#"]').forEach(link => {
    link.addEventListener('click', () => { closeMenu(); });
  });

  // cerrar al clicar fuera del nav (mobile)
  document.addEventListener('click', (e) => {
    const target = e.target;
    if (!nav.contains(target) && !btn.contains(target)) {
      closeMenu();
    }
  });

  // asegurar estado al redimensionar
  window.addEventListener('resize', () => {
    if (window.innerWidth >= 640) { // sm breakpoint
      // en desktop queremos que el responsive nav no interfiera
      nav.classList.add('opacity-0', '-translate-y-2', 'pointer-events-none');
      nav.classList.remove('opacity-100', 'translate-y-0');
      nav.setAttribute('aria-hidden', 'true');
      btn.setAttribute('aria-expanded', 'false');
      if (iconOpen && iconClose) { iconOpen.classList.remove('hidden'); iconClose.classList.add('hidden'); }
    }
  });
});
</script>